{"ts":1360870636717,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1360870672383,"patch":[[{"diffs":[[1,"var spawn = require('child_process').spawn;\r\nvar fs = require('fs');\r\n\r\nvar Image = function Image(document) {\r\n    this.objects = document ? [document] : [];\r\n }\r\n\r\nImage.prototype.convert = function(callback, filename) {    \r\n  var cmdOptions = []; \r\n  cmdOptions = cmdOptions.concat(buildCmdOptions(this.objects[0], filename));\r\n  //var wkhtmltoimage_path = process.env.PORT ? './bin/wkhtmltoimage-amd64' : 'wkhtmltoimage';\r\n  var wkhtmltoimage_path = process.env.PORT ? './bin/wkhtmltoimage' : 'wkhtmltoimage';\r\n\r\n  var convert = spawn(wkhtmltoimage_path,cmdOptions); \r\n  \r\n  //take care of direct stdin html\r\n  if (this.objects[0].html) {\r\n    var inputHTML = spawn (\"echo\",this.objects[0].html);\r\n    inputHTML.stdout.on('data', function (data) {\r\n        convert.stdin.write(data);\r\n    });\r\n    inputHTML.on ('exit', function () {\r\n        convert.stdin.end();\r\n    });\r\n  }\r\n\r\n  var image = [];\r\n  var err;\r\n\r\n  convert.stdout.on('data', function (data) {\r\n      image.push(data);\r\n  });\r\n\r\n  convert.stderr.on('data', function (data) {\r\n      err += data;\r\n  });\r\n\r\n  convert.on ('exit', function (code) {\r\n      if (code) {\r\n        console.log ('child process exited with code ' + code);\r\n      } else { \r\n      \r\n        if(!filename) {\r\n          //combine the buffers\r\n          var size = 0;\r\n          for (var i=0; i < image.length; ++i) {\r\n            size+= image[0].length;\r\n          }\r\n          var combinedBuffer = new Buffer (size);\r\n          var pos = 0;\r\n          for (var i=0; i < image.length; ++i) {\r\n            if (pos > size) {\r\n              break;\r\n            }\r\n            image[i].copy(combinedBuffer, pos, 0, image[i].length);\r\n            pos += image[i].length;\r\n          }\r\n\r\n          callback (err, combinedBuffer);\r\n        } else {\r\n          callback (err);\r\n        }\r\n      }\r\n  });\r\n}\r\n\r\n//take global options and make them into an array\r\nvar buildOptions = function(options) {\r\n  var commandOptions = [];\r\n  for (name in options) {\r\n    if (options.hasOwnProperty(name)) {\r\n      commandOptions.push(name);\r\n    }\r\n  }\r\n  return commandOptions;\r\n};\r\n\r\n//build the essential options for the wkhtmltoimage command\r\nvar buildCmdOptions = function (objects, filename) {\r\n  //wkhtml options\r\n  var cmdOptions = [];\r\n  if (objects.options) {\r\n    cmdOptions = buildOptions(objects.options);\r\n  }\r\n\r\n  //input source\r\n  if (objects.html) {\r\n    cmdOptions.push('-');\r\n  } else if (objects.filename) {\r\n    cmdOptions.push(objects.filename);\r\n  } else {\r\n    cmdOptions.push(objects.url);\r\n  }\r\n\r\n  //output\r\n  if (filename) {\r\n    cmdOptions.push(filename);\r\n  } else {\r\n    cmdOptions.push('-');\r\n  }\r\n    \r\n  return cmdOptions;\r\n};\r\n\r\nmodule.exports.createImage = function (request, response, callback) {\r\n  var theURL = request.session.url ? request.session.url : \"http://www.google.com\";\r\n  new Image({ url: theURL }).convert (function (err, data) {\r\n      if (err)\r\n        console.log (err);\r\n      if (data) {\r\n        //see if we have a callback function\r\n        if (callback) {\r\n          callback (data, request, response); \r\n        } else {\r\n          response.writeHead(200, {'Content-Type' : 'image/png',\r\n                                   'Content-Size' : data.length }); \r\n          response.write(data);\r\n          response.end ();\r\n        }\r\n      } else {\r\n        fs.createReadStream('./image_error.html').pipe(response);\r\n      }\r\n  });\r\n}"]],"start1":0,"start2":0,"length1":0,"length2":3412}]],"length":3412,"saved":false}
{"ts":1360870692005,"patch":[[{"diffs":[[0,"if (err)"],[1," {"],[0,"\r\n      "]],"start1":2910,"start2":2910,"length1":16,"length2":18},{"diffs":[[0,"sole.log"],[-1," "],[0,"(err);\r\n"],[1,"      }\r\n"],[0,"      if"]],"start1":2933,"start2":2933,"length1":25,"length2":33}]],"length":3422,"saved":false}
{"ts":1360871519926,"patch":[[{"diffs":[[0,"\r\n};\r\n\r\n"],[1,"module.exports.getImage = function (request, response, callback) {\r\n  var theURL = request.session.url ? request.session.url : \"http://www.google.com\";\r\n  new Image({ url: theURL }).convert (function (err, data) {\r\n      if (err) {\r\n        console.log(err);\r\n      }\r\n      if (data) {\r\n        //see if we have a callback function\r\n        if (callback) {\r\n          callback (data, request, response); \r\n        } else {\r\n          response.writeHead(200, {'Content-Type' : 'image/png',\r\n                                   'Content-Size' : data.length }); \r\n          response.write(data);\r\n          response.end ();\r\n        }\r\n      } else {\r\n        fs.createReadStream('./image_error.html').pipe(response);\r\n      }\r\n  });\r\n}\r\n\r\n"],[0,"module.e"]],"start1":2678,"start2":2678,"length1":16,"length2":753}]],"length":4159,"saved":false}
{"ts":1360872654498,"patch":[[{"diffs":[[0,"ltoimage"],[1,"-i396"],[0,"' : 'wkh"]],"start1":486,"start2":486,"length1":16,"length2":21}]],"length":4164,"saved":false}
{"ts":1360874816871,"patch":[[{"diffs":[[0,"s');\r\n\r\n"],[1,"//"],[0,"var Imag"]],"start1":64,"start2":64,"length1":16,"length2":18},{"diffs":[[0,"ocument) {\r\n"],[1,"module.exports.Image = function Image(document) {\r\n"],[0,"    this.obj"]],"start1":102,"start2":102,"length1":24,"length2":75}]],"length":4217,"saved":false}
{"ts":1360875025278,"patch":[[{"diffs":[[0,"on ("],[-1,"request, response, callback) {\r\n  var theURL = request.session.url ? request.session.url : \"http://www.google.com\";"],[1,"url) {"],[0,"\r\n  "]],"start1":2776,"start2":2776,"length1":123,"length2":14},{"diffs":[[0,"ew Image({ url: "],[-1,"theURL"],[1,"url"],[0," }).convert (fun"]],"start1":2791,"start2":2791,"length1":38,"length2":35}]],"length":4105,"saved":false}
{"ts":1360875108418,"patch":[[{"diffs":[[0,"nction ("],[-1,""],[1,"req,res,"],[0,"url) {\r\n"]],"start1":2772,"start2":2772,"length1":16,"length2":24},{"diffs":[[0,"    "],[-1,"if (callback) {\r\n          callback (data, request, response); \r\n        } else {\r\n          response"],[1,"  res"],[0,".wri"]],"start1":2978,"start2":2978,"length1":109,"length2":13},{"diffs":[[0,"ng',"],[-1,"\r\n                                   "],[0,"'Con"]],"start1":3029,"start2":3029,"length1":45,"length2":8},{"diffs":[[0," \r\n          res"],[-1,"ponse"],[0,".write(data);\r\n "]],"start1":3065,"start2":3065,"length1":37,"length2":32},{"diffs":[[0,";\r\n          res"],[-1,"ponse"],[0,".end ();\r\n      "]],"start1":3093,"start2":3093,"length1":37,"length2":32},{"diffs":[[0,"    "],[-1,"fs.createReadStream('./image_error.html').pipe(response"],[1,"rese.writeHead(200, {'Content-Type' : 'text/html','Content-Size' : data.length }); \r\n        res.write(\"error\");\r\n        res.end ("],[0,");\r\n"]],"start1":3150,"start2":3150,"length1":63,"length2":139}]],"length":4046,"saved":false}
{"ts":1360875134092,"patch":[[{"diffs":[[0,"es.end ();\r\n"],[-1,"        }\r\n"],[0,"      } else"]],"start1":3107,"start2":3107,"length1":35,"length2":24},{"diffs":[[0,"     res"],[-1,"e"],[0,".writeHe"]],"start1":3138,"start2":3138,"length1":17,"length2":16}]],"length":4034,"saved":false}
{"ts":1360875385704,"patch":[[{"diffs":[[0,"s');\r\n\r\n"],[-1,"//"],[0,"var Imag"]],"start1":64,"start2":64,"length1":18,"length2":16},{"diffs":[[0," {\r\n"],[-1,"module.exports.Image = function Image(document) {\r\n"],[0,"    "]],"start1":108,"start2":108,"length1":59,"length2":8}]],"length":3981,"saved":false}
{"ts":1360875540600,"patch":[[{"diffs":[[0,"tml'"],[-1,",'Content-Size' : data.length "],[0,"}); "]],"start1":3134,"start2":3134,"length1":38,"length2":8}]],"length":3951,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360938605842,"patch":[[{"diffs":[[0,"oimage';\r\n  "],[1,"//"],[0,"var wkhtmlto"]],"start1":418,"start2":418,"length1":24,"length2":26}]],"length":3953,"saved":false}
{"ts":1360938611967,"patch":[[{"diffs":[[0,"ename));\r\n  "],[-1,"//"],[0,"var wkhtmlto"]],"start1":322,"start2":322,"length1":26,"length2":24}]],"length":3951,"saved":false}
{"ts":1360938986937,"patch":[[{"diffs":[[0,"ename));\r\n  "],[1,"//"],[0,"var wkhtmlto"]],"start1":322,"start2":322,"length1":24,"length2":26},{"diffs":[[0,"oimage';\r\n  "],[-1,"//"],[0,"var wkhtmlto"]],"start1":418,"start2":418,"length1":26,"length2":24}]],"length":3951,"saved":false}
{"ts":1360939166842,"patch":[[{"diffs":[[0,"tion\r\n          "],[1,"//"],[0,"res.writeHead(20"]],"start1":2915,"start2":2915,"length1":32,"length2":34},{"diffs":[[0,"}); \r\n          "],[1,"//"],[0,"res.write(data);"]],"start1":3011,"start2":3011,"length1":32,"length2":34},{"diffs":[[0,"s.write(data);\r\n"],[1,"          //res.end ();\r\n           res.writeHead(200, {'Content-Type' : 'text/html'}); \r\n            res.write(data.toString());\r\n  "],[0,"          res.en"]],"start1":3031,"start2":3031,"length1":32,"length2":165}]],"length":4088,"saved":false}
{"ts":1360939177271,"patch":[[{"diffs":[[0,"text/html'}); \r\n"],[1,"           res.write(\"data:\");\r\n"],[0,"            res."]],"start1":3121,"start2":3121,"length1":32,"length2":64}]],"length":4120,"saved":false}
{"ts":1360939455937,"patch":[[{"diffs":[[0,"t-Type' : 'text/"],[-1,"html"],[1,"plain"],[0,"'}); \r\n        r"]],"start1":3286,"start2":3286,"length1":36,"length2":37}]],"length":4121,"saved":false}
{"ts":1360939464631,"patch":[[{"diffs":[[0,": 'text/"],[-1,"html"],[1,"plain"],[0,"'}); \r\n "]],"start1":3118,"start2":3118,"length1":20,"length2":21}]],"length":4122,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360940947003,"patch":[[{"diffs":[[0,"e));\r\n  "],[-1,"//"],[0,"var wkht"]],"start1":326,"start2":326,"length1":18,"length2":16},{"diffs":[[0,"oimage';\r\n  "],[1,"//"],[0,"var wkhtmlto"]],"start1":416,"start2":416,"length1":24,"length2":26}]],"length":4122,"saved":false}
{"ts":1360941414615,"patch":[[{"diffs":[[0,");\r\n            "],[1,"//"],[0,"res.write(data.t"]],"start1":3166,"start2":3166,"length1":32,"length2":34}]],"length":4124,"saved":false}
{"ts":1360941618542,"patch":[[{"diffs":[[0,"tion\r\n          "],[-1,"//"],[0,"res.writeHead(20"]],"start1":2915,"start2":2915,"length1":34,"length2":32},{"diffs":[[0,"}); \r\n          "],[-1,"//"],[0,"res.write(data);"]],"start1":3009,"start2":3009,"length1":34,"length2":32},{"diffs":[[0,"\r\n          "],[-1,"//"],[0,"res.end ();\r"]],"start1":3041,"start2":3041,"length1":26,"length2":24},{"diffs":[[0,"    "],[-1," "],[-1,"res.writeHead(200, {'Content-Type' : 'text/plain'}); \r\n           res.write(\"data:\");\r\n            //res.write(data.toString());\r\n            res.end ();"],[0,"\r\n  "]],"start1":3072,"start2":3072,"length1":162,"length2":8}]],"length":3964,"saved":false}
{"ts":1360941916065,"patch":[[{"diffs":[[0,"ename));\r\n  "],[1,"//"],[0,"var wkhtmlto"]],"start1":322,"start2":322,"length1":24,"length2":26},{"diffs":[[0,"oimage';\r\n  "],[-1,"//"],[0,"var wkhtmlto"]],"start1":418,"start2":418,"length1":26,"length2":24}]],"length":3964,"saved":false}
{"ts":1360942077736,"patch":[[{"diffs":[[0,"e));\r\n  "],[-1,"//"],[0,"var wkht"]],"start1":326,"start2":326,"length1":18,"length2":16},{"diffs":[[0,"oimage';\r\n  "],[1,"//"],[0,"var wkhtmlto"]],"start1":416,"start2":416,"length1":24,"length2":26}]],"length":3964,"saved":false}
{"ts":1360942317838,"patch":[[{"diffs":[[0,"ction\r\n         "],[1,"//"],[0," res.writeHead(2"]],"start1":2914,"start2":2914,"length1":32,"length2":34},{"diffs":[[0,"ta.length }); \r\n"],[1,"         res.writeHead(200, {'Content-Type' : 'text/plain'})\r\n"],[0,"          res.wr"]],"start1":3001,"start2":3001,"length1":32,"length2":94}]],"length":4028,"saved":false}
{"ts":1360942325391,"patch":[[{"diffs":[[0,"  res.write(data"],[1,".toString()"],[0,");\r\n          re"]],"start1":3087,"start2":3087,"length1":32,"length2":43}]],"length":4039,"saved":false}
{"ts":1360942503134,"patch":[[{"diffs":[[0,"ite("],[-1,"data.toString()"],[1,"err"],[0,");\r\n"]],"start1":3095,"start2":3095,"length1":23,"length2":11}]],"length":4027,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360943241694,"patch":[[{"diffs":[[0,"        "],[-1," //"],[0," res.wri"]],"start1":2921,"start2":2921,"length1":19,"length2":16},{"diffs":[[0," }); \r\n         "],[1,"//"],[0,"res.writeHead(20"]],"start1":3007,"start2":3007,"length1":32,"length2":34},{"diffs":[[0,"s.write("],[-1,"err"],[1,"data"],[0,");\r\n    "]],"start1":3090,"start2":3090,"length1":19,"length2":20}]],"length":4027,"saved":false}
{"ts":1360943345042,"patch":[[{"diffs":[[0,"\n}\r\n"],[-1,"\r\nmodule.exports.createImage = function (request, response, callback) {\r\n  var theURL = request.session.url ? request.session.url : \"http://www.google.com\";\r\n  new Image({ url: theURL }).convert (function (err, data) {\r\n      if (err) {\r\n        console.log(err);\r\n      }\r\n      if (data) {\r\n        //see if we have a callback function\r\n        if (callback) {\r\n          callback (data, request, response); \r\n        } else {\r\n          response.writeHead(200, {'Content-Type' : 'image/png',\r\n                                   'Content-Size' : data.length }); \r\n          response.write(data);\r\n          response.end ();\r\n        }\r\n      } else {\r\n        fs.createReadStream('./image_error.html').pipe(response);\r\n      }\r\n  });\r\n}"]],"start1":3285,"start2":3285,"length1":742,"length2":4}]],"length":3289,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360952881902,"patch":[[{"diffs":[[0,"url: url"],[1,", options:['--width 760','--height 400']"],[0," }).conv"]],"start1":2757,"start2":2757,"length1":16,"length2":56}]],"length":3329,"saved":false}
{"ts":1360953387621,"patch":[[{"diffs":[[0,"ons) {\r\n    "],[1,"//"],[0,"if (options."]],"start1":1986,"start2":1986,"length1":24,"length2":26},{"diffs":[[0,"name);\r\n    "],[1,"//"],[0,"}\r\n  }\r\n  re"]],"start1":2063,"start2":2063,"length1":24,"length2":26}]],"length":3333,"saved":false}
{"ts":1360953774332,"patch":[[{"diffs":[[0,"//}\r\n  }\r\n  "],[1,"//"],[0,"return comma"]],"start1":2075,"start2":2075,"length1":24,"length2":26},{"diffs":[[0,"ndOptions;\r\n"],[1,"  return options;\r\n"],[0,"};\r\n\r\n//buil"]],"start1":2101,"start2":2101,"length1":24,"length2":43}]],"length":3354,"saved":false}
{"ts":1360954139170,"patch":[[{"diffs":[[0,".options);\r\n"],[1,"    cmdOptions = objects.options;\r\n"],[0,"  }\r\n\r\n  //i"]],"start1":2360,"start2":2360,"length1":24,"length2":59}]],"length":3389,"saved":false}
{"ts":1360954495184,"patch":[[{"diffs":[[0,"mage';\r\n\r\n  "],[1,"//"],[0,"var convert "]],"start1":513,"start2":513,"length1":24,"length2":26},{"diffs":[[0,"ons); \r\n"],[1,"  var convert = spawn(wkhtmltoimage_path,['--width 760','--height 500','http://www.google.com','-']); \r\n"],[0,"  \r\n  //"]],"start1":573,"start2":573,"length1":16,"length2":120}]],"length":3495,"saved":false}
{"ts":1360954613834,"patch":[[{"diffs":[[0,"options) {\r\n    "],[1,"//"],[0,"cmdOptions = bui"]],"start1":2417,"start2":2417,"length1":32,"length2":34}]],"length":3497,"saved":false}
{"ts":1360954864976,"patch":[[{"diffs":[[0,"e_path,['--width"],[-1," "],[1,"','"],[0,"760','--height 5"]],"start1":615,"start2":615,"length1":33,"length2":35},{"diffs":[[0,"--height"],[-1," "],[1,"','"],[0,"500','ht"]],"start1":640,"start2":640,"length1":17,"length2":19}]],"length":3501,"saved":false}
{"ts":1360955057646,"patch":[[{"diffs":[[0,"mage';\r\n\r\n  "],[-1,"//"],[0,"var convert "]],"start1":513,"start2":513,"length1":26,"length2":24},{"diffs":[[0,"tions); \r\n  "],[1,"//"],[0,"var convert "]],"start1":569,"start2":569,"length1":24,"length2":26}]],"length":3501,"saved":false}
{"ts":1360955094581,"patch":[[{"diffs":[[0,"'--width"],[-1," "],[1,"','"],[0,"760','--"]],"start1":2948,"start2":2948,"length1":17,"length2":19},{"diffs":[[0,"--height"],[-1," "],[1,"','"],[0,"400'] })"]],"start1":2965,"start2":2965,"length1":17,"length2":19}]],"length":3505,"saved":false}
{"ts":1360955777764,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"//take global options and make them into an array\r\nvar buildOptions = function(options) {\r\n  var commandOptions = [];\r\n  for (name in options) {\r\n    //if (options.hasOwnProperty(name)) {\r\n      commandOptions.push(name);\r\n    //}\r\n  }\r\n  //return commandOptions;\r\n  return options;\r\n};\r\n\r\n"],[0,"//bu"]],"start1":1954,"start2":1954,"length1":298,"length2":8},{"diffs":[[0," {\r\n"],[-1,"    //cmdOptions = buildOptions(objects.options);\r\n"],[0,"    "]],"start1":2139,"start2":2139,"length1":59,"length2":8}]],"length":3164,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361013229328,"patch":[[{"diffs":[[0,"nction\r\n        "],[-1," "],[0,"res.writeHead(20"]],"start1":2788,"start2":2788,"length1":33,"length2":32},{"diffs":[[0,"; \r\n"],[-1,"         //res.writeHead(200, {'Content-Type' : 'text/plain'})\r\n  "],[0,"    "]],"start1":2884,"start2":2884,"length1":74,"length2":8},{"diffs":[[0,"ite(data);\r\n"],[-1,"  "],[0,"        res."]],"start1":2902,"start2":2902,"length1":26,"length2":24},{"diffs":[[0,");\r\n"],[-1,"          \r\n"],[0,"    "]],"start1":2931,"start2":2931,"length1":20,"length2":8}]],"length":3083,"saved":false}
{"ts":1361013248884,"patch":[[{"diffs":[[0,"ame) {\r\n"],[1,"  "],[0,"  //wkht"]],"start1":2065,"start2":2065,"length1":16,"length2":18},{"diffs":[[0,"ptions\r\n"],[1,"  "],[0,"  var cm"]],"start1":2087,"start2":2087,"length1":16,"length2":18},{"diffs":[[0,"ns = [];\r\n  "],[1," "],[1," "],[0,"if (objects."]],"start1":2111,"start2":2111,"length1":24,"length2":26},{"diffs":[[0,"options) {\r\n    "],[1,"   "],[1," "],[0,"cmdOptions = obj"]],"start1":2137,"start2":2137,"length1":32,"length2":36},{"diffs":[[0,"s;\r\n"],[1,"  "],[0,"  }\r\n"],[1,"    "],[0,"\r\n  "],[1," "],[1," "],[0,"//input"],[-1," source"],[0,"\r\n"],[1,"  "],[0,"  if"]],"start1":2184,"start2":2184,"length1":33,"length2":36},{"diffs":[[0,"ts.html) {\r\n    "],[1,"  "],[1,"  "],[0,"cmdOptions.push("]],"start1":2227,"start2":2227,"length1":32,"length2":36},{"diffs":[[0,"push('-');\r\n"],[1,"  "],[0,"  } else if "]],"start1":2258,"start2":2258,"length1":24,"length2":26},{"diffs":[[0,"ts.filename) {\r\n"],[1,"    "],[0,"    cmdOptions.p"]],"start1":2290,"start2":2290,"length1":32,"length2":36},{"diffs":[[0,"cts.filename);\r\n"],[1,"  "],[0,"  } else {\r\n    "]],"start1":2334,"start2":2334,"length1":32,"length2":34},{"diffs":[[0,"  } else {\r\n    "],[1,"  "],[1,"  "],[0,"cmdOptions.push("]],"start1":2352,"start2":2352,"length1":32,"length2":36},{"diffs":[[0,".url);\r\n"],[1,"  "],[0,"  }\r\n"],[1,"    "],[0,"\r\n"],[1,"  "],[0,"  //outp"]],"start1":2395,"start2":2395,"length1":23,"length2":31},{"diffs":[[0,"output\r\n"],[1,"  "],[0,"  if (fi"]],"start1":2422,"start2":2422,"length1":16,"length2":18},{"diffs":[[0,"ilename) {\r\n"],[1,"    "],[0,"    cmdOptio"]],"start1":2439,"start2":2439,"length1":24,"length2":28},{"diffs":[[0,"name);\r\n"],[1,"  "],[0,"  } else"]],"start1":2479,"start2":2479,"length1":16,"length2":18},{"diffs":[[0,"  } else {\r\n"],[1,"    "],[0,"    cmdOptio"]],"start1":2489,"start2":2489,"length1":24,"length2":28},{"diffs":[[0,"push('-');\r\n"],[1,"  "],[0,"  }\r\n    \r\n "]],"start1":2520,"start2":2520,"length1":24,"length2":26},{"diffs":[[0,"\r\n    \r\n"],[1,"  "],[0,"  return"]],"start1":2537,"start2":2537,"length1":16,"length2":18}]],"length":3136,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361014122582,"patch":[[{"diffs":[[0,"t','400'"],[1,",'--javascript-delay','300'"],[0,"] }).con"]],"start1":2684,"start2":2684,"length1":16,"length2":43}]],"length":3163,"saved":false}
{"ts":1361014161265,"patch":[[{"diffs":[[0,"y','300'"],[1,",'--quality','100'"],[0,"] }).con"]],"start1":2711,"start2":2711,"length1":16,"length2":34}]],"length":3181,"saved":false}
{"ts":1361014477777,"patch":[[{"diffs":[[0,"concat(build"],[-1,"Cmd"],[0,"Options(this"]],"start1":279,"start2":279,"length1":27,"length2":24},{"diffs":[[0,"; \r\n"],[-1,"  //var convert = spawn(wkhtmltoimage_path,['--width','760','--height','500','http://www.google.com','-']); \r\n"],[0,"  \r\n"]],"start1":572,"start2":572,"length1":118,"length2":8},{"diffs":[[0,"\r\n//"],[1," "],[0,"build "],[-1,"the essential "],[0,"opti"]],"start1":1843,"start2":1843,"length1":28,"length2":15},{"diffs":[[0,"uild"],[-1,"Cmd"],[0,"Opti"]],"start1":1898,"start2":1898,"length1":11,"length2":8},{"diffs":[[0,"\r\n    //"],[1," "],[0,"wkhtml o"]],"start1":1942,"start2":1942,"length1":16,"length2":17},{"diffs":[[0,"\r\n    //"],[1," "],[0,"input\r\n "]],"start1":2071,"start2":2071,"length1":16,"length2":17},{"diffs":[[0,"\r\n    \r\n"],[-1,""],[0,"    //"],[1," "],[0,"output\r\n"]],"start1":2281,"start2":2281,"length1":22,"length2":23}]],"length":3055,"saved":false}
{"ts":1361014547156,"patch":[[{"diffs":[[0," {    \r\n"],[1,"  "],[0,"  var cm"]],"start1":220,"start2":220,"length1":16,"length2":18},{"diffs":[[0,"= []; \r\n"],[1,"  "],[0,"  cmdOpt"]],"start1":247,"start2":247,"length1":16,"length2":18},{"diffs":[[0,"ame));\r\n"],[1,"  "],[0,"  var wk"]],"start1":325,"start2":325,"length1":16,"length2":18},{"diffs":[[0,"ge';\r\n  "],[1," "],[1," "],[0,"//var wk"]],"start1":423,"start2":423,"length1":16,"length2":18},{"diffs":[[0,"mage';\r\n"],[-1,"\r\n"],[1,"    \r\n  "],[0,"  var co"]],"start1":518,"start2":518,"length1":18,"length2":24},{"diffs":[[0,"\r\n  "],[1,"  "],[0,"\r\n  "],[1,"  "],[0,"//"],[-1,"take care of"],[0," dir"]],"start1":588,"start2":588,"length1":26,"length2":18},{"diffs":[[0,"n html\r\n"],[1,"  "],[0,"  if (th"]],"start1":614,"start2":614,"length1":16,"length2":18},{"diffs":[[0,"   });\r\n"],[1,"  "],[0,"  }\r\n"],[1,"    "],[0,"\r\n"],[1,"  "],[0,"  var im"]],"start1":881,"start2":881,"length1":23,"length2":31},{"diffs":[[0," = [];\r\n"],[1,"  "],[0,"  var er"]],"start1":915,"start2":915,"length1":16,"length2":18},{"diffs":[[0,"r err;\r\n"],[-1,"\r\n"],[1,"    \r\n  "],[0,"  conver"]],"start1":929,"start2":929,"length1":18,"length2":24},{"diffs":[[0,"a) {\r\n      "],[1,"  "],[0,"image.push(d"]],"start1":986,"start2":986,"length1":24,"length2":26},{"diffs":[[0,"data);\r\n"],[1,"  "],[0,"  });\r\n"],[1,"    "],[0,"\r\n"],[1,"  "],[0,"  conver"]],"start1":1011,"start2":1011,"length1":25,"length2":33},{"diffs":[[0,"\r\n      "],[1,"  "],[0,"err += d"]],"start1":1081,"start2":1081,"length1":16,"length2":18},{"diffs":[[0,"a;\r\n"],[1,"  "],[0,"  });\r\n"],[-1,"\r\n"],[1,"    \r\n  "],[0,"  co"]],"start1":1101,"start2":1101,"length1":17,"length2":25},{"diffs":[[0,"n (code) {\r\n"],[1,"  "],[0,"      if (co"]],"start1":1151,"start2":1151,"length1":24,"length2":26},{"diffs":[[0,"ode) {\r\n        "],[1,"    "],[0,"console.log ('ch"]],"start1":1176,"start2":1176,"length1":32,"length2":36},{"diffs":[[0,"de);\r\n      "],[-1,"}"],[1,"  }\r\n       "],[0," else { \r\n  "]],"start1":1247,"start2":1247,"length1":25,"length2":36},{"diffs":[[0,"e { \r\n      "],[-1,"\r\n"],[1,"  \r\n    "],[0,"        if(!"]],"start1":1275,"start2":1275,"length1":26,"length2":32},{"diffs":[[0,"        "],[1,"      "],[0,"//combin"]],"start1":1322,"start2":1322,"length1":16,"length2":22},{"diffs":[[0,"\r\n          "],[1," "],[1,"     "],[0,"var size = 0"]],"start1":1357,"start2":1357,"length1":24,"length2":30},{"diffs":[[0," size = 0;\r\n"],[1,"      "],[0,"          fo"]],"start1":1378,"start2":1378,"length1":24,"length2":30},{"diffs":[[0,"        "],[1,"  "],[1,"      "],[0,"size+= i"]],"start1":1450,"start2":1450,"length1":16,"length2":24},{"diffs":[[0,"gth;\r\n          "],[1,"      "],[0,"}\r\n          var"]],"start1":1485,"start2":1485,"length1":32,"length2":38},{"diffs":[[0,"\r\n          "],[1,"  "],[1,"    "],[0,"var combined"]],"start1":1508,"start2":1508,"length1":24,"length2":30},{"diffs":[[0,"\r\n          "],[1,"      "],[0,"var pos = 0;"]],"start1":1565,"start2":1565,"length1":24,"length2":30},{"diffs":[[0,"= 0;\r\n          "],[1,"    "],[1,"  "],[0,"for (var i=0; i "]],"start1":1591,"start2":1591,"length1":32,"length2":38},{"diffs":[[0,"            "],[1,"        "],[0,"if (pos > si"]],"start1":1653,"start2":1653,"length1":24,"length2":32},{"diffs":[[0,"    "],[1,"    "],[1,"      "],[0,"break;\r\n"],[1,"        "],[0,"    "]],"start1":1702,"start2":1702,"length1":16,"length2":34},{"diffs":[[0,"            "],[1,"        "],[0,"image[i].cop"]],"start1":1747,"start2":1747,"length1":24,"length2":32},{"diffs":[[0,"        "],[1,"        "],[0,"pos += i"]],"start1":1828,"start2":1828,"length1":16,"length2":24},{"diffs":[[0,"        "],[-1,"}\r\n\r\n"],[1,"      }\r\n      "],[0,"        "]],"start1":1871,"start2":1871,"length1":21,"length2":31},{"diffs":[[0,");\r\n        "],[1,"    "],[0,"} else {\r\n  "]],"start1":1933,"start2":1933,"length1":24,"length2":28},{"diffs":[[0,"      } else {\r\n"],[1,"      "],[0,"          callba"]],"start1":1943,"start2":1943,"length1":32,"length2":38},{"diffs":[[0,"ack (err);\r\n"],[1,"            }\r\n"],[0,"        }\r\n "]],"start1":1980,"start2":1980,"length1":24,"length2":39},{"diffs":[[0,"       }\r\n  "],[-1,"    }\r\n"],[0,""],[1,""],[0,"  });\r\n}\r\n\r\n"]],"start1":2008,"start2":2008,"length1":31,"length2":24}]],"length":3242,"saved":false}
{"ts":1361014559707,"patch":[[{"diffs":[[0,"{ \r\n"],[-1,"        \r\n"],[0,"    "]],"start1":1277,"start2":1277,"length1":18,"length2":8}]],"length":3232,"saved":false}
{"ts":1361014572135,"patch":[[{"diffs":[[0,"ons for "],[-1,"the "],[0,"wkhtmlto"]],"start1":2035,"start2":2035,"length1":20,"length2":16}]],"length":3228,"saved":false}
{"ts":1361014606992,"patch":[[{"diffs":[[0,"ptions\r\n    var "],[-1,"cmdO"],[1,"o"],[0,"ptions = [];\r\n  "]],"start1":2132,"start2":2132,"length1":36,"length2":33},{"diffs":[[0," {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions = obj"]],"start1":2187,"start2":2187,"length1":28,"length2":25},{"diffs":[[0,"tml) {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions.push('-')"]],"start1":2271,"start2":2271,"length1":36,"length2":33},{"diffs":[[0,"ame) {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions.push(obje"]],"start1":2335,"start2":2335,"length1":36,"length2":33},{"diffs":[[0,"else {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions.push(obje"]],"start1":2390,"start2":2390,"length1":36,"length2":33},{"diffs":[[0,"ame) {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions.push(file"]],"start1":2475,"start2":2475,"length1":36,"length2":33},{"diffs":[[0," {\r\n        "],[-1,"cmdO"],[1,"o"],[0,"ptions.push("]],"start1":2526,"start2":2526,"length1":28,"length2":25},{"diffs":[[0," return "],[-1,"cmdO"],[1,"o"],[0,"ptions;\r"]],"start1":2574,"start2":2574,"length1":20,"length2":17}]],"length":3204,"saved":false}
{"ts":1361014610247,"patch":[[{"diffs":[[0,"ilename) {\r\n"],[1,"    \r\n"],[0,"    // wkhtm"]],"start1":2105,"start2":2105,"length1":24,"length2":30}]],"length":3210,"saved":false}
{"ts":1361014614363,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"// build options for wkhtmltoimage command\r\n"],[0,"var "]],"start1":2018,"start2":2018,"length1":52,"length2":8}]],"length":3166,"saved":false}
{"ts":1361014631442,"patch":[[{"diffs":[[0,"// input"],[1," filename or url"],[0,"\r\n    if"]],"start1":2206,"start2":2206,"length1":16,"length2":32},{"diffs":[[0,"/ output"],[1," filename or -"],[0,"\r\n    if"]],"start1":2430,"start2":2430,"length1":16,"length2":30}]],"length":3196,"saved":false}
{"ts":1361014667117,"patch":[[{"diffs":[[0," {\r\n"],[-1,"                //combine the buffers\r\n"],[0,"    "]],"start1":1306,"start2":1306,"length1":47,"length2":8},{"diffs":[[0," size = 0;\r\n"],[1,""],[0,"            "]],"start1":1329,"start2":1329,"length1":24,"length2":24},{"diffs":[[0,"    var "],[-1,"combinedB"],[1,"b"],[0,"uffer = "]],"start1":1473,"start2":1473,"length1":25,"length2":17},{"diffs":[[0,"i].copy("],[-1,"combinedB"],[1,"b"],[0,"uffer, p"]],"start1":1716,"start2":1716,"length1":25,"length2":17},{"diffs":[[0,"rr, "],[-1,"combinedB"],[1,"b"],[0,"uffe"]],"start1":1850,"start2":1850,"length1":17,"length2":9}]],"length":3133,"saved":false}
{"ts":1361014708500,"patch":[[{"diffs":[[0,"n html\r\n"],[1,"    /*\r\n"],[0,"    if ("]],"start1":614,"start2":614,"length1":16,"length2":24},{"diffs":[[0,"r inputH"],[-1,"TML"],[1,"tml"],[0," = spawn"]],"start1":669,"start2":669,"length1":19,"length2":19},{"diffs":[[0,"  inputH"],[-1,"TML"],[1,"tml"],[0,".stdout."]],"start1":723,"start2":723,"length1":19,"length2":19},{"diffs":[[0,"putH"],[-1,"TML"],[1,"tml"],[0,".on "]],"start1":823,"start2":823,"length1":11,"length2":11},{"diffs":[[0,";\r\n    });\r\n"],[-1,""],[0,"    }\r\n"],[1,"    */\r\n"],[0,"    \r\n    va"]],"start1":885,"start2":885,"length1":31,"length2":39}]],"length":3149,"saved":false}
{"ts":1361014735849,"patch":[[{"diffs":[[0," : [];\r\n"],[-1," "],[0,"}\r\n\r\nIma"]],"start1":152,"start2":152,"length1":17,"length2":16}]],"length":3148,"saved":false}
{"ts":1361014925280,"patch":[[{"diffs":[[0,"    var "],[-1,"cmdO"],[1,"o"],[0,"ptions ="]],"start1":227,"start2":227,"length1":20,"length2":17},{"diffs":[[0,"; \r\n    "],[-1,"cmdO"],[1,"o"],[0,"ptions ="]],"start1":247,"start2":247,"length1":20,"length2":17},{"diffs":[[0,"tions = "],[-1,"cmdO"],[1,"o"],[0,"ptions.c"]],"start1":257,"start2":257,"length1":20,"length2":17},{"diffs":[[0,"ilename));\r\n"],[1,"    \r\n"],[0,"    var wkht"]],"start1":311,"start2":311,"length1":24,"length2":30},{"diffs":[[0,"ath,"],[-1,"cmdOptions); \r\n    \r\n    // direct stdin html\r\n    /*\r\n    if (this.objects[0].html) {\r\n    var inputHtml = spawn (\"echo\",this.objects[0].html);\r\n    inputHtml.stdout.on('data', function (data) {\r\n        convert.stdin.write(data);\r\n    });\r\n    inputHtml.on ('exit', function () {\r\n        convert.stdin.end();\r\n    });\r\n    }\r\n    */\r\n"],[1,"options); "],[0,"    "]],"start1":567,"start2":567,"length1":345,"length2":18}]],"length":2818,"saved":false}
{"ts":1361014930064,"patch":[[{"diffs":[[0,"ptions);"],[-1,"     "],[0,"\r\n    va"]],"start1":572,"start2":572,"length1":21,"length2":16}]],"length":2813,"saved":false}
{"ts":1361014965278,"patch":[[{"diffs":[[0,"       for (var "],[-1,"i"],[1,"j"],[0,"=0; "],[-1,"i"],[1,"j"],[0," < image.length;"]],"start1":1229,"start2":1229,"length1":38,"length2":38},{"diffs":[[0,"image.length; ++"],[-1,"i"],[1,"j"],[0,") {\r\n           "]],"start1":1254,"start2":1254,"length1":33,"length2":33},{"diffs":[[0,"  image["],[-1,"i"],[1,"j"],[0,"].copy(b"]],"start1":1388,"start2":1388,"length1":17,"length2":17},{"diffs":[[0,"s, 0, image["],[-1,"i"],[1,"j"],[0,"].length);\r\n"]],"start1":1414,"start2":1414,"length1":25,"length2":25},{"diffs":[[0,"= image["],[-1,"i"],[1,"j"],[0,"].length"]],"start1":1464,"start2":1464,"length1":17,"length2":17}]],"length":2813,"saved":false}
